<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<style>
/* CSS for Markstat 2.0 using Pandoc 2.0 */
body{padding:14px 28px;}
body, table {font-family: Helvetica, Arial, Sans-serif; font-size: 14px;}
h1, h2, h3, h4 {font-weight: normal; color: #3366cc}
h1 {font-size: 200%;}
h2 {font-size: 150%;}
h3 {font-size: 120%;}
h4 {font-size: 100%; font-weight:bold}
img.center {display:block; margin-left:auto; margin-right:auto}
.small{font-size:8pt;}
a {color: black;}
a:visited {color: #808080;}
a.plain {text-decoration:none;}
a.plain:hover {text-decoration:underline;}
.em {font-weight:bold;}
pre, code {font-family: "lucida console", monospace;}
pre.stata {font-size:13px; line-height:13px;}
pre {padding:8px; border:1px solid #c0c0c0; border-radius:8px; background-color:#fdfdfd;}
code {color:#3366cc; background-color:#fafafa;}
pre code { color:black; background-color:white}
/* Added for Pandoc */
figure > img, div.figure > img {display:block; margin:auto}
figcaption, p.caption {text-align:center; font-weight:bold; color:#3366cc;}
h1.title {text-align:center; margin-bottom:0}
p.author, h2.author {font-style:italic; text-align:center;margin-top:4px;margin-bottom:0}
p.date, h3.date {text-align:center;margin-top:4px; margin-bottom:0}
/* Tables*/
table { margin:auto; border-collapse:collapse; }
table caption { margin-bottom:1ex;}
th, td { padding:4px 6px;}
thead tr:first-child th {border-top:1px solid black; padding-top:6px}
thead tr:last-child  th {padding-bottom:6px}
tbody tr:first-child td {border-top:1px solid black; padding-top:6px}
tbody tr:last-child  td {padding-bottom:6px;}
table tbody:last-child tr:last-child td {border-bottom:1px solid black;}
</style>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Andy Grogan-Kaylor" />
  <title>Interactions in Logistic Regression</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Interactions in Logistic Regression</h1>
<p class="author">Andy Grogan-Kaylor</p>
<p class="date">25 Mar 2020 16:27:12</p>
</header>
<h1 id="the-math">The Math</h1>
<p><span class="math inline">\(\ln(\frac{p(y)}{1-p(y)}) = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + ...\)</span></p>
<p>Set <span class="math inline">\(\beta_0 + \beta_1 x_1 + \beta_2 x_2 + ... =\)</span> to <span class="math inline">\(z\)</span>.</p>
<p>Then</p>
<p><span class="math inline">\(\ln(\frac{p(y)}{1-p(y)}) = z\)</span></p>
<p><span class="math inline">\(\frac{p(y)}{1-p(y)} = e^z\)</span></p>
<p><span class="math inline">\(p(y) = e^z(1-p(y))\)</span></p>
<p><span class="math inline">\(p(y) = e^z-e^z(p(y))\)</span></p>
<p><span class="math inline">\(e^z p(y) + p(y) = e^z\)</span></p>
<p><span class="math inline">\((1 + e^z) p(y) = e^z\)</span></p>
<p><span class="math inline">\(p(y) = \frac{e^z}{1 + e^z}\)</span></p>
<p><span class="math inline">\(p(y) = \frac{e^{\beta_0 + \beta_1 x1 + \beta_2 x2 + ...}}{1 + e^{\beta_0 + \beta_1 x1 + \beta_2 x2 + ...}}\)</span></p>
<h1 id="simulate-some-data">Simulate Some Data</h1>
<pre class='stata'>. clear all // empty data
</pre>
<pre class='stata'>. set obs 10000 // set observations
number of observations (_N) was 0, now 10,000
</pre>
<pre class='stata'>. generate x1 = rnormal(0, 2) // normally distributed
</pre>
<pre class='stata'>. histogram x1, scheme(michigan)
(bin=40, start=-7.6521349, width=.41272972)
</pre>
<pre class='stata'>. graph export myx1graph.png, width(200) replace
(file myx1graph.png written in PNG format)
</pre>
<figure>
<img src="myx1graph.png" alt="Histogram of x1" /><figcaption>Histogram of x1</figcaption>
</figure>
<pre class='stata'>. generate x2 = rbinomial(1, .5) // categorical variable
</pre>
<pre class='stata'>. graph bar, over(x2) scheme(michigan)
</pre>
<pre class='stata'>. graph export myx2graph.png, width(200) replace
(file myx2graph.png written in PNG format)
</pre>
<figure>
<img src="myx2graph.png" alt="Bar Graph of x2" /><figcaption>Bar Graph of x2</figcaption>
</figure>
<pre class='stata'>. summarize // descriptive statistics

    Variable │        Obs        Mean    Std. Dev.       Min        Max
─────────────┼─────────────────────────────────────────────────────────
          x1 │     10,000   -.0290809    1.982619  -7.652135   8.857054
          x2 │     10,000       .5011    .5000238          0          1
</pre>
<h1 id="story-a-main-effects-only">Story A: Main Effects Only</h1>
<h2 id="set-up-the-data">Set Up The Data</h2>
<pre class='stata'>. generate zA = x1 + x2 // first z
</pre>
<pre class='stata'>. generate pA = exp(zA) / (1 + exp(zA)) // probabilities
</pre>
<pre class='stata'>. summarize pA // descriptive statistics

    Variable │        Obs        Mean    Std. Dev.       Min        Max
─────────────┼─────────────────────────────────────────────────────────
          pA │     10,000     .570506     .313263   .0004748   .9999476
</pre>
<pre class='stata'>. generate yA = rbinomial(1, pA) // generate y with probability p
</pre>
<p>i.e.</p>
<p><span class="math display">\[\ln\Bigg{(}\frac{p(y)}{1-p(y)}\Bigg{)} = \beta_0 + \beta_1 x_1 + \beta_2 x_2\]</span></p>
<pre class='stata'>. tab yA // descriptive statistics

         yA │      Freq.     Percent        Cum.
────────────┼───────────────────────────────────
          0 │      4,327       43.27       43.27
          1 │      5,673       56.73      100.00
────────────┼───────────────────────────────────
      Total │     10,000      100.00
</pre>
<h2 id="logistic-regression">Logistic Regression</h2>
<pre class='stata'>. logit yA x1 x2 // does it recover the parameters?

Iteration 0:   log likelihood = -6840.6105  
Iteration 1:   log likelihood = -4543.7709  
Iteration 2:   log likelihood = -4495.6702  
Iteration 3:   log likelihood = -4494.8694  
Iteration 4:   log likelihood = -4494.8692  

Logistic regression                             Number of obs     =     10,000
                                                LR chi2(2)        =    4691.48
                                                Prob > chi2       =     0.0000
Log likelihood = -4494.8692                     Pseudo R2         =     0.3429

─────────────┬────────────────────────────────────────────────────────────────
          yA │      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
─────────────┼────────────────────────────────────────────────────────────────
          x1 │   1.006231   .0206865    48.64   0.000     .9656864    1.046776
          x2 │    .978571   .0537042    18.22   0.000     .8733126    1.083829
       _cons │  -.0096955   .0363177    -0.27   0.789    -.0808769    .0614859
─────────────┴────────────────────────────────────────────────────────────────
</pre>
<pre class='stata'>. predict yhatA // predicted probabilities
(option pr assumed; Pr(yA))
</pre>
<h1 id="story-b-main-effects-interactions">Story B: Main Effects + Interactions</h1>
<h2 id="set-up-the-data-1">Set Up The Data</h2>
<pre class='stata'>. generate zB = x1 + x2 + (.75 * x1 * x2) // second z
</pre>
<pre class='stata'>. generate pB = exp(zB) / (1 + exp(zB)) // probabilities
</pre>
<pre class='stata'>. summarize pB // descriptive statistics

    Variable │        Obs        Mean    Std. Dev.       Min        Max
─────────────┼─────────────────────────────────────────────────────────
          pB │     10,000    .5464316    .3496357   7.88e-06   .9999999
</pre>
<pre class='stata'>. generate yB = rbinomial(1, pB) // generate y with probability p
</pre>
<p>i.e.</p>
<p><span class="math display">\[\ln\Bigg{(}\frac{p(y)}{1-p(y)}\Bigg{)} = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \beta_3 x_1 * x_2\]</span></p>
<pre class='stata'>. tab yB // descriptive statistics

         yB │      Freq.     Percent        Cum.
────────────┼───────────────────────────────────
          0 │      4,568       45.68       45.68
          1 │      5,432       54.32      100.00
────────────┼───────────────────────────────────
      Total │     10,000      100.00
</pre>
<h2 id="logistic-regression-1">Logistic Regression</h2>
<pre class='stata'>. logit yB c.x1##i.x2 // does it recover the parameters?

Iteration 0:   log likelihood = -6894.1004  
Iteration 1:   log likelihood = -3982.6146  
Iteration 2:   log likelihood = -3912.0868  
Iteration 3:   log likelihood =  -3908.866  
Iteration 4:   log likelihood = -3908.8595  
Iteration 5:   log likelihood = -3908.8595  

Logistic regression                             Number of obs     =     10,000
                                                LR chi2(3)        =    5970.48
                                                Prob > chi2       =     0.0000
Log likelihood = -3908.8595                     Pseudo R2         =     0.4330

─────────────┬────────────────────────────────────────────────────────────────
          yB │      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
─────────────┼────────────────────────────────────────────────────────────────
          x1 │   .9960435   .0287374    34.66   0.000     .9397193    1.052368
        1.x2 │   .9928199    .061885    16.04   0.000     .8715275    1.114112
             │
     x2#c.x1 │
          1  │   .7398848   .0579223    12.77   0.000     .6263593    .8534103
             │
       _cons │   -.025353   .0362111    -0.70   0.484    -.0963254    .0456194
─────────────┴────────────────────────────────────────────────────────────────
</pre>
<pre class='stata'>. predict yhatB // predicted probabilities
(option pr assumed; Pr(yB))
</pre>
<h1 id="inspect-the-situation-with-a-graph">Inspect The Situation With A Graph</h1>
<p>Think for a moment about what an interaction term <span class="math inline">\(\beta x_1 * x_2\)</span> is <em>supposed</em> to capture: the <em>difference</em> between slopes.</p>
<p>Notice that at different values of <span class="math inline">\(x\)</span> the <em>difference</em> between the two slopes is <em>different</em></p>
<p>At <span class="math inline">\(x = 0\)</span>, the <font color="orange"><strong>orange</strong></font> line is steeper than the <font color="green"><strong>green</strong></font> line.</p>
<p>At <span class="math inline">\(x = 2\)</span>, the <font color="green"><strong>green</strong></font> line is steeper than the <font color="orange"><strong>orange</strong></font> line.</p>
<p>No single static parameter can capture this changing difference between two slopes.</p>
<pre class='stata'>. twoway ///
> (scatter yB x1 if x2 == 0, msize(tiny)) /// points
> (scatter yB x1 if x2 == 1, msize(tiny)) /// points
> (scatter yhatB x1 if x2 == 0, msize(tiny)) ///
> (scatter yhatB x1 if x2 == 1, msize(tiny)), ///
> xline(0 2) ///
> title("Logit Curves for 2 Groups") ///
> sub("Model With Interaction") ///
> scheme(michigan)
</pre>
<pre class='stata'>. graph export mygraph.png, width(500) replace
(file mygraph.png written in PNG format)
</pre>
<figure>
<img src="mygraph.png" alt="Logistic Regression With Interactions" /><figcaption>Logistic Regression With Interactions</figcaption>
</figure>
</body>
</html>
