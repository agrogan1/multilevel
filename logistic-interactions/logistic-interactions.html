<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<style>
/* CSS for Markstat 2.0 using Pandoc 2.0 */
body{padding:14px 28px;}
body, table {font-family: Helvetica, Arial, Sans-serif; font-size: 14px;}
h1, h2, h3, h4 {font-weight: normal; color: #3366cc}
h1 {font-size: 200%;}
h2 {font-size: 150%;}
h3 {font-size: 120%;}
h4 {font-size: 100%; font-weight:bold}
img.center {display:block; margin-left:auto; margin-right:auto}
.small{font-size:8pt;}
a {color: black;}
a:visited {color: #808080;}
a.plain {text-decoration:none;}
a.plain:hover {text-decoration:underline;}
.em {font-weight:bold;}
pre, code {font-family: "lucida console", monospace;}
pre.stata {font-size:13px; line-height:13px;}
pre {padding:8px; border:1px solid #c0c0c0; border-radius:8px; background-color:#fdfdfd;}
code {color:#3366cc; background-color:#fafafa;}
pre code { color:black; background-color:white}
/* Added for Pandoc */
figure > img, div.figure > img {display:block; margin:auto}
figcaption, p.caption {text-align:center; font-weight:bold; color:#3366cc;}
h1.title {text-align:center; margin-bottom:0}
p.author, h2.author {font-style:italic; text-align:center;margin-top:4px;margin-bottom:0}
p.date, h3.date {text-align:center;margin-top:4px; margin-bottom:0}
/* Tables*/
table { margin:auto; border-collapse:collapse; }
table caption { margin-bottom:1ex;}
th, td { padding:4px 6px;}
thead tr:first-child th {border-top:1px solid black; padding-top:6px}
thead tr:last-child  th {padding-bottom:6px}
tbody tr:first-child td {border-top:1px solid black; padding-top:6px}
tbody tr:last-child  td {padding-bottom:6px;}
table tbody:last-child tr:last-child td {border-bottom:1px solid black;}
</style>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Andy Grogan-Kaylor" />
  <title>Interactions in Logistic Regression</title>
  <style type="text/css">code{white-space: pre;}</style>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
</head>
<body>
<div id="header">
<h1 class="title">Interactions in Logistic Regression</h1>
<h2 class="author">Andy Grogan-Kaylor</h2>
<h3 class="date">10 Mar 2020 13:53:45</h3>
</div>
<h1 id="the-math">The Math</h1>
<p><span class="math inline">\(ln(\frac{p(y)}{1-p(y)}) = \beta_0 + \beta_1 x1 + \beta_2 x2 + ...\)</span></p>
<p>Set <span class="math inline">\(\beta_0 + \beta_1 x1 + \beta_2 x2 + ...\)</span> to <span class="math inline">\(z\)</span>.</p>
<p>Then</p>
<p><span class="math inline">\(ln(\frac{p(y)}{1-p(y)}) = z\)</span></p>
<p><span class="math inline">\(\frac{p(y)}{1-p(y)} = e^z\)</span></p>
<p><span class="math inline">\(p(y) = e^z(1-p(y))\)</span></p>
<p><span class="math inline">\(p(y) = e^z-e^z(p(y))\)</span></p>
<p><span class="math inline">\(e^z p(y) + p(y) = e^z\)</span></p>
<p><span class="math inline">\((1 + e^z) p(y) = e^z\)</span></p>
<p><span class="math inline">\(p(y) = \frac{e^z}{1 + e^z}\)</span></p>
<p><span class="math inline">\(p(y) = \frac{e^{\beta_0 + \beta_1 x1 + \beta_2 x2 + ...}}{1 + e^{\beta_0 + \beta_1 x1 + \beta_2 x2 + ...}}\)</span></p>
<h1 id="simulate-some-data">Simulate Some Data</h1>
<pre class='stata'>. clear all // empty data
</pre>
<pre class='stata'>. set obs 10000 // set observations
number of observations (_N) was 0, now 10,000
</pre>
<pre class='stata'>. generate x1 = rnormal(0, 2) // normally distributed
</pre>
<pre class='stata'>. generate x2 = rbinomial(1, .5) // categorical variable
</pre>
<pre class='stata'>. summarize // descriptive statistics

    Variable │        Obs        Mean    Std. Dev.       Min        Max
─────────────┼─────────────────────────────────────────────────────────
          x1 │     10,000   -.0147188    1.984978  -9.027139   8.149453
          x2 │     10,000       .4981    .5000214          0          1
</pre>
<h1 id="story-a-main-effects-only">Story A: Main Effects Only</h1>
<pre class='stata'>. generate zA = x1 + x2 // first z
</pre>
<pre class='stata'>. generate pA = exp(zA) / (1 + exp(zA)) // probabilities
</pre>
<pre class='stata'>. summarize pA // descriptive statistics

    Variable │        Obs        Mean    Std. Dev.       Min        Max
─────────────┼─────────────────────────────────────────────────────────
          pA │     10,000    .5738759    .3134713   .0001201   .9998937
</pre>
<pre class='stata'>. generate yA = rbinomial(1, pA) // generate y with probability p
</pre>
<pre class='stata'>. tab yA // descriptive statistics

         yA │      Freq.     Percent        Cum.
────────────┼───────────────────────────────────
          0 │      4,277       42.77       42.77
          1 │      5,723       57.23      100.00
────────────┼───────────────────────────────────
      Total │     10,000      100.00
</pre>
<pre class='stata'>. logit yA x1 x2 // does it recover the parameters?

Iteration 0:   log likelihood = -6826.5586  
Iteration 1:   log likelihood = -4627.0466  
Iteration 2:   log likelihood =  -4582.194  
Iteration 3:   log likelihood = -4582.1534  
Iteration 4:   log likelihood = -4582.1534  

Logistic regression                             Number of obs     =     10,000
                                                LR chi2(2)        =    4488.81
                                                Prob > chi2       =     0.0000
Log likelihood = -4582.1534                     Pseudo R2         =     0.3288

─────────────┬────────────────────────────────────────────────────────────────
          yA │      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
─────────────┼────────────────────────────────────────────────────────────────
          x1 │   .9646467   .0199707    48.30   0.000     .9255049    1.003788
          x2 │   .9267962   .0528754    17.53   0.000     .8231623     1.03043
       _cons │   .0152885   .0359784     0.42   0.671    -.0552279    .0858048
─────────────┴────────────────────────────────────────────────────────────────
</pre>
<pre class='stata'>. predict yhatA // predicted probabilities
(option pr assumed; Pr(yA))
</pre>
<h1 id="story-b-main-effects-interactions">Story B: Main Effects + Interactions</h1>
<pre class='stata'>. generate zB = x1 + x2 + (.75 * x1 * x2) // second z
</pre>
<pre class='stata'>. generate pB = exp(zB) / (1 + exp(zB)) // probabilities
</pre>
<pre class='stata'>. summarize pB // descriptive statistics

    Variable │        Obs        Mean    Std. Dev.       Min        Max
─────────────┼─────────────────────────────────────────────────────────
          pB │     10,000    .5509044    .3490754   .0000804   .9999998
</pre>
<pre class='stata'>. generate yB = rbinomial(1, pB) // generate y with probability p
</pre>
<pre class='stata'>. tab yB // descriptive statistics

         yB │      Freq.     Percent        Cum.
────────────┼───────────────────────────────────
          0 │      4,438       44.38       44.38
          1 │      5,562       55.62      100.00
────────────┼───────────────────────────────────
      Total │     10,000      100.00
</pre>
<pre class='stata'>. logit yB c.x1##i.x2 // does it recover the parameters?

Iteration 0:   log likelihood = -6868.1693  
Iteration 1:   log likelihood = -3984.1708  
Iteration 2:   log likelihood = -3914.7939  
Iteration 3:   log likelihood = -3911.7641  
Iteration 4:   log likelihood =  -3911.753  
Iteration 5:   log likelihood =  -3911.753  

Logistic regression                             Number of obs     =     10,000
                                                LR chi2(3)        =    5912.83
                                                Prob > chi2       =     0.0000
Log likelihood =  -3911.753                     Pseudo R2         =     0.4305

─────────────┬────────────────────────────────────────────────────────────────
          yB │      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
─────────────┼────────────────────────────────────────────────────────────────
          x1 │   1.008038   .0287392    35.08   0.000     .9517105    1.064366
        1.x2 │   .9029883   .0614474    14.70   0.000     .7825537    1.023423
             │
     x2#c.x1 │
          1  │   .6999957   .0573718    12.20   0.000      .587549    .8124424
             │
       _cons │   .0735326   .0364831     2.02   0.044      .002027    .1450382
─────────────┴────────────────────────────────────────────────────────────────
</pre>
<pre class='stata'>. predict yhatB // predicted probabilities
(option pr assumed; Pr(yB))
</pre>
<h1 id="inspect-the-situation-with-a-graph">Inspect The Situation With A Graph</h1>
<pre class='stata'>. twoway ///
> (scatter yB x1 if x2 == 0, msize(tiny)) /// points
> (scatter yB x1 if x2 == 1, msize(tiny)) /// points
> (scatter yhatB x1 if x2 == 0, msize(tiny)) ///
> (scatter yhatB x1 if x2 == 1, msize(tiny)), ///
> title("Logit Curves for 2 Groups") ///
> scheme(michigan)
</pre>
<pre class='stata'>. quietly graph export mygraph.png, width(500) replace
</pre>
<div class="figure">
<img src="mygraph.png" alt="Logistic Regression With Interactions" />
<p class="caption">Logistic Regression With Interactions</p>
</div>
</body>
</html>
