<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<style>
/* CSS for Markstat 2.0 using Pandoc 2.0 */
body{padding:14px 28px;}
body, table {font-family: Helvetica, Arial, Sans-serif; font-size: 14px;}
h1, h2, h3, h4 {font-weight: normal; color: #3366cc}
h1 {font-size: 200%;}
h2 {font-size: 150%;}
h3 {font-size: 120%;}
h4 {font-size: 100%; font-weight:bold}
img.center {display:block; margin-left:auto; margin-right:auto}
.small{font-size:8pt;}
a {color: black;}
a:visited {color: #808080;}
a.plain {text-decoration:none;}
a.plain:hover {text-decoration:underline;}
.em {font-weight:bold;}
pre, code {font-family: "lucida console", monospace;}
pre.stata {font-size:13px; line-height:13px;}
pre {padding:8px; border:1px solid #c0c0c0; border-radius:8px; background-color:#fdfdfd;}
code {color:#3366cc; background-color:#fafafa;}
pre code { color:black; background-color:white}
/* Added for Pandoc */
figure > img, div.figure > img {display:block; margin:auto}
figcaption, p.caption {text-align:center; font-weight:bold; color:#3366cc;}
h1.title {text-align:center; margin-bottom:0}
p.author, h2.author {font-style:italic; text-align:center;margin-top:4px;margin-bottom:0}
p.date, h3.date {text-align:center;margin-top:4px; margin-bottom:0}
/* Tables*/
table { margin:auto; border-collapse:collapse; }
table caption { margin-bottom:1ex;}
th, td { padding:4px 6px;}
thead tr:first-child th {border-top:1px solid black; padding-top:6px}
thead tr:last-child  th {padding-bottom:6px}
tbody tr:first-child td {border-top:1px solid black; padding-top:6px}
tbody tr:last-child  td {padding-bottom:6px;}
table tbody:last-child tr:last-child td {border-bottom:1px solid black;}
</style>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Andy Grogan-Kaylor" />
  <title>Interactions in Logistic Regression</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Interactions in Logistic Regression</h1>
<p class="author">Andy Grogan-Kaylor</p>
<p class="date">20 Mar 2020 08:22:43</p>
</header>
<h1 id="the-math">The Math</h1>
<p><span class="math inline">\(\ln(\frac{p(y)}{1-p(y)}) = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + ...\)</span></p>
<p>Set <span class="math inline">\(\beta_0 + \beta_1 x_1 + \beta_2 x_2 + ... =\)</span> to <span class="math inline">\(z\)</span>.</p>
<p>Then</p>
<p><span class="math inline">\(\ln(\frac{p(y)}{1-p(y)}) = z\)</span></p>
<p><span class="math inline">\(\frac{p(y)}{1-p(y)} = e^z\)</span></p>
<p><span class="math inline">\(p(y) = e^z(1-p(y))\)</span></p>
<p><span class="math inline">\(p(y) = e^z-e^z(p(y))\)</span></p>
<p><span class="math inline">\(e^z p(y) + p(y) = e^z\)</span></p>
<p><span class="math inline">\((1 + e^z) p(y) = e^z\)</span></p>
<p><span class="math inline">\(p(y) = \frac{e^z}{1 + e^z}\)</span></p>
<p><span class="math inline">\(p(y) = \frac{e^{\beta_0 + \beta_1 x1 + \beta_2 x2 + ...}}{1 + e^{\beta_0 + \beta_1 x1 + \beta_2 x2 + ...}}\)</span></p>
<h1 id="simulate-some-data">Simulate Some Data</h1>
<pre class='stata'>. clear all // empty data
</pre>
<pre class='stata'>. set obs 10000 // set observations
number of observations (_N) was 0, now 10,000
</pre>
<pre class='stata'>. generate x1 = rnormal(0, 2) // normally distributed
</pre>
<pre class='stata'>. histogram x1, scheme(michigan)
(bin=40, start=-8.316865, width=.39425235)
</pre>
<pre class='stata'>. graph export myx1graph.png, width(200) replace
(file myx1graph.png written in PNG format)
</pre>
<figure>
<img src="myx1graph.png" alt="Histogram of x1" /><figcaption>Histogram of x1</figcaption>
</figure>
<pre class='stata'>. generate x2 = rbinomial(1, .5) // categorical variable
</pre>
<pre class='stata'>. graph bar, over(x2) scheme(michigan)
</pre>
<pre class='stata'>. graph export myx2graph.png, width(200) replace
(file myx2graph.png written in PNG format)
</pre>
<figure>
<img src="myx2graph.png" alt="Bar Graph of x2" /><figcaption>Bar Graph of x2</figcaption>
</figure>
<pre class='stata'>. summarize // descriptive statistics

    Variable │        Obs        Mean    Std. Dev.       Min        Max
─────────────┼─────────────────────────────────────────────────────────
          x1 │     10,000    .0126806     1.99713  -8.316865   7.453229
          x2 │     10,000       .4914     .499951          0          1
</pre>
<h1 id="story-a-main-effects-only">Story A: Main Effects Only</h1>
<h2 id="set-up-the-data">Set Up The Data</h2>
<pre class='stata'>. generate zA = x1 + x2 // first z
</pre>
<pre class='stata'>. generate pA = exp(zA) / (1 + exp(zA)) // probabilities
</pre>
<pre class='stata'>. summarize pA // descriptive statistics

    Variable │        Obs        Mean    Std. Dev.       Min        Max
─────────────┼─────────────────────────────────────────────────────────
          pA │     10,000    .5742931     .312551   .0002443   .9997869
</pre>
<pre class='stata'>. generate yA = rbinomial(1, pA) // generate y with probability p
</pre>
<p>i.e.</p>
<p><span class="math display">\[\ln\Bigg{(}\frac{p(y)}{1-p(y)}\Bigg{)} = \beta_0 + \beta_1 x_1 + \beta_2 x_2\]</span></p>
<pre class='stata'>. tab yA // descriptive statistics

         yA │      Freq.     Percent        Cum.
────────────┼───────────────────────────────────
          0 │      4,288       42.88       42.88
          1 │      5,712       57.12      100.00
────────────┼───────────────────────────────────
      Total │     10,000      100.00
</pre>
<h2 id="logistic-regression">Logistic Regression</h2>
<pre class='stata'>. logit yA x1 x2 // does it recover the parameters?

Iteration 0:   log likelihood = -6829.7375  
Iteration 1:   log likelihood = -4519.9834  
Iteration 2:   log likelihood = -4468.6743  
Iteration 3:   log likelihood = -4467.9269  
Iteration 4:   log likelihood = -4467.9267  

Logistic regression                             Number of obs     =     10,000
                                                LR chi2(2)        =    4723.62
                                                Prob > chi2       =     0.0000
Log likelihood = -4467.9267                     Pseudo R2         =     0.3458

─────────────┬────────────────────────────────────────────────────────────────
          yA │      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
─────────────┼────────────────────────────────────────────────────────────────
          x1 │   1.011516   .0208294    48.56   0.000     .9706917    1.052341
          x2 │   1.055538   .0542218    19.47   0.000     .9492649    1.161811
       _cons │  -.0442423   .0360868    -1.23   0.220    -.1149711    .0264865
─────────────┴────────────────────────────────────────────────────────────────
</pre>
<pre class='stata'>. predict yhatA // predicted probabilities
(option pr assumed; Pr(yA))
</pre>
<h1 id="story-b-main-effects-interactions">Story B: Main Effects + Interactions</h1>
<h2 id="set-up-the-data-1">Set Up The Data</h2>
<pre class='stata'>. generate zB = x1 + x2 + (.75 * x1 * x2) // second z
</pre>
<pre class='stata'>. generate pB = exp(zB) / (1 + exp(zB)) // probabilities
</pre>
<pre class='stata'>. summarize pB // descriptive statistics

    Variable │        Obs        Mean    Std. Dev.       Min        Max
─────────────┼─────────────────────────────────────────────────────────
          pB │     10,000    .5505714    .3483016   3.34e-06   .9999992
</pre>
<pre class='stata'>. generate yB = rbinomial(1, pB) // generate y with probability p
</pre>
<p>i.e.</p>
<p><span class="math display">\[\ln\Bigg{(}\frac{p(y)}{1-p(y)}\Bigg{)} = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \beta_3 x_1 * x_2\]</span></p>
<pre class='stata'>. tab yB // descriptive statistics

         yB │      Freq.     Percent        Cum.
────────────┼───────────────────────────────────
          0 │      4,459       44.59       44.59
          1 │      5,541       55.41      100.00
────────────┼───────────────────────────────────
      Total │     10,000      100.00
</pre>
<h2 id="logistic-regression-1">Logistic Regression</h2>
<pre class='stata'>. logit yB c.x1##i.x2 // does it recover the parameters?

Iteration 0:   log likelihood = -6872.8209  
Iteration 1:   log likelihood = -3954.8434  
Iteration 2:   log likelihood = -3867.5072  
Iteration 3:   log likelihood =   -3863.05  
Iteration 4:   log likelihood = -3863.0356  
Iteration 5:   log likelihood = -3863.0356  

Logistic regression                             Number of obs     =     10,000
                                                LR chi2(3)        =    6019.57
                                                Prob > chi2       =     0.0000
Log likelihood = -3863.0356                     Pseudo R2         =     0.4379

─────────────┬────────────────────────────────────────────────────────────────
          yB │      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
─────────────┼────────────────────────────────────────────────────────────────
          x1 │    1.01595   .0289157    35.13   0.000     .9592759    1.072623
        1.x2 │    1.00315    .063427    15.82   0.000     .8788351    1.127464
             │
     x2#c.x1 │
          1  │   .7652222   .0600379    12.75   0.000     .6475501    .8828943
             │
       _cons │   .0325715   .0361302     0.90   0.367    -.0382424    .1033853
─────────────┴────────────────────────────────────────────────────────────────
</pre>
<pre class='stata'>. predict yhatB // predicted probabilities
(option pr assumed; Pr(yB))
</pre>
<h1 id="inspect-the-situation-with-a-graph">Inspect The Situation With A Graph</h1>
<pre class='stata'>. twoway ///
> (scatter yB x1 if x2 == 0, msize(tiny)) /// points
> (scatter yB x1 if x2 == 1, msize(tiny)) /// points
> (scatter yhatB x1 if x2 == 0, msize(tiny)) ///
> (scatter yhatB x1 if x2 == 1, msize(tiny)), ///
> title("Logit Curves for 2 Groups") ///
> scheme(michigan)
</pre>
<pre class='stata'>. graph export mygraph.png, width(500) replace
(file mygraph.png written in PNG format)
</pre>
<figure>
<img src="mygraph.png" alt="Logistic Regression With Interactions" /><figcaption>Logistic Regression With Interactions</figcaption>
</figure>
</body>
</html>
